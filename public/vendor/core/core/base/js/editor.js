(()=>{"use strict";function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}const t=function(){function t(e,a,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.loader=e,this.url=a,this.t=n}var a,n,i;return a=t,(n=[{key:"upload",value:function(){var e=this;return this.loader.file.then((function(t){return new Promise((function(a,n){e._initRequest(),e._initListeners(a,n,t),e._sendRequest(t)}))}))}},{key:"abort",value:function(){this.xhr&&this.xhr.abort()}},{key:"_initRequest",value:function(){var e=this.xhr=new XMLHttpRequest;e.open("POST",this.url,!0),e.responseType="json"}},{key:"_initListeners",value:function(e,t,a){var n=this.xhr,i=this.loader,o=(0,this.t)("Cannot upload file:")+" ".concat(a.name,".");n.addEventListener("error",(function(){return t(o)})),n.addEventListener("abort",(function(){return t()})),n.addEventListener("load",(function(){var a=n.response;if(!a||!a.uploaded)return t(a&&a.error&&a.error.message?a.error.message:o);e({default:a.url})})),n.upload&&n.upload.addEventListener("progress",(function(e){e.lengthComputable&&(i.uploadTotal=e.total,i.uploaded=e.loaded)}))}},{key:"_sendRequest",value:function(e){var t=new FormData;t.append("upload",e),t.append("_token",$('meta[name="csrf-token"]').attr("content")),this.xhr.send(t)}}])&&e(a.prototype,n),i&&e(a,i),t}();function a(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.CKEDITOR={},this.shortcodes=[]}var o,r,l;return o=e,r=[{key:"initCkEditor",value:function(e,i){var o=this;if(this.CKEDITOR[e]||!$("#"+e).is(":visible"))return!1;var r=document.querySelector("#"+e);ClassicEditor.create(r,function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach((function(t){n(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({fontSize:{options:[9,11,13,"default",17,16,18,19,21,22,23,24]},alignment:{options:["left","right","center","justify"]},shortcode:{onEdit:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},a=null;o.shortcodes.length&&o.shortcodes.forEach((function(e){if(e.key===t)return a=e.description,!0})),o.shortcodeCallback({key:t,href:route("short-codes.ajax-get-admin-config",t),data:{code:e},description:a,previewImage:"",update:!0})},shortcodes:this.getShortcodesAvailable(r)||[],onCallback:function(e,t){o.shortcodeCallback({key:e,href:t.url,previewImage:""})}},heading:{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h1",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h2",title:"Heading 2",class:"ck-heading_heading2"},{model:"heading3",view:"h3",title:"Heading 3",class:"ck-heading_heading3"},{model:"heading4",view:"h4",title:"Heading 4",class:"ck-heading_heading4"}]},placeholder:" ",toolbar:{items:["heading","|","fontColor","fontSize","fontBackgroundColor","fontFamily","bold","italic","underline","link","strikethrough","bulletedList","numberedList","|","alignment","direction","shortcode","outdent","indent","|","htmlEmbed","imageInsert","blockQuote","insertTable","mediaEmbed","undo","redo","findAndReplace","removeFormat","sourceEditing","codeBlock"]},language:{ui:window.siteEditorLocale||"en",content:window.siteEditorLocale||"en"},image:{toolbar:["imageTextAlternative","imageStyle:inline","imageStyle:block","imageStyle:side","toggleImageCaption","ImageResize"],upload:{types:["jpeg","png","gif","bmp","webp","tiff","svg+xml"]}},codeBlock:{languages:[{language:"plaintext",label:"Plain text"},{language:"c",label:"C"},{language:"cs",label:"C#"},{language:"cpp",label:"C++"},{language:"css",label:"CSS"},{language:"diff",label:"Diff"},{language:"html",label:"HTML"},{language:"java",label:"Java"},{language:"javascript",label:"JavaScript"},{language:"php",label:"PHP"},{language:"python",label:"Python"},{language:"ruby",label:"Ruby"},{language:"typescript",label:"TypeScript"},{language:"xml",label:"XML"},{language:"dart",label:"Dart",class:"language-dart"}]},link:{defaultProtocol:"http://",decorators:{openInNewTab:{mode:"manual",label:"Open in a new tab",attributes:{target:"_blank",rel:"noopener noreferrer"}}}},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells","tableCellProperties","tableProperties"]},htmlSupport:{allow:[{name:/.*/,attributes:!0,classes:!0,styles:!0}]}},i)).then((function(a){a.plugins.get("FileRepository").createUploadAdapter=function(e){return new t(e,RV_MEDIA_URL.media_upload_from_editor,a.t)},a.insertHtml=function(e){var t=a.data.processor.toView(e),n=a.data.toModel(t);a.model.insertContent(n)},window.editor=a,o.CKEDITOR[e]=a;var n,i=90*$("#"+e).prop("rows"),r="ckeditor-".concat(e,"-inline");$(a.ui.view.editable.element).addClass(r).after("\n                    <style>\n                        .ck-editor__editable_inline {\n                            min-height: ".concat(i-100,"px;\n                            max-height: ").concat(i+100,"px;\n                        }\n                    </style>\n                ")),a.model.document.on("change:data",(function(){clearTimeout(n),n=setTimeout((function(){a.updateSourceElement()}),150)})),a.commands._commands.get("mediaEmbed").execute=function(e){a.insertHtml('[media url="'.concat(e,'"][/media]'))}})).catch((function(e){console.error(e)}))}},{key:"getShortcodesAvailable",value:function(e){var t,a=null===(t=$(e).parents(".form-group").find(".add_shortcode_btn_trigger"))||void 0===t?void 0:t.next(".dropdown-menu"),n=[];return a&&a.find("> li").length&&a.find("> li").each((function(){var e=$(this).find("> a");n.push({key:e.data("key"),hasConfig:e.data("has-admin-config"),name:e.text(),url:e.attr("href"),description:e.data("description")})})),this.shortcodes=n,n}},{key:"uploadImageFromEditor",value:function(e,t){var a=new FormData;"function"==typeof e.blob?a.append("upload",e.blob(),e.filename()):a.append("upload",e),$.ajax({type:"POST",data:a,url:RV_MEDIA_URL.media_upload_from_editor,processData:!1,contentType:!1,cache:!1,success:function(e){e.uploaded&&t(e.url)}})}},{key:"initTinyMce",value:function(e){var t=this;tinymce.init({menubar:!0,selector:"#"+e,min_height:110*$("#"+e).prop("rows"),resize:"vertical",plugins:"code autolink advlist visualchars link image media table charmap hr pagebreak nonbreaking anchor insertdatetime lists wordcount imagetools visualblocks",extended_valid_elements:"input[id|name|value|type|class|style|required|placeholder|autocomplete|onclick]",toolbar:"formatselect | bold italic strikethrough forecolor backcolor | link image table | alignleft aligncenter alignright alignjustify  | numlist bullist indent  |  visualblocks code",convert_urls:!1,image_caption:!0,image_advtab:!0,image_title:!0,placeholder:"",contextmenu:"link image inserttable | cell row column deletetable",images_upload_url:RV_MEDIA_URL.media_upload_from_editor,automatic_uploads:!0,block_unsupported_drop:!1,file_picker_types:"file image media",images_upload_handler:this.uploadImageFromEditor.bind(this),file_picker_callback:function(e){$('<input type="file" accept="image/*" />').click().on("change",(function(a){t.uploadImageFromEditor(a.target.files[0],e)}))}})}},{key:"initEditor",value:function(e,t,a){if(!e.length)return!1;var n=this;switch(a){case"ckeditor":$.each(e,(function(e,a){n.initCkEditor($(a).prop("id"),t)}));break;case"tinymce":$.each(e,(function(e,t){n.initTinyMce($(t).prop("id"))}))}}},{key:"init",value:function(){var e=this,t=$(document).find(".editor-ckeditor"),a=$(document).find(".editor-tinymce"),n=this;return t.length>0&&n.initEditor(t,{},"ckeditor"),a.length>0&&n.initEditor(a,{},"tinymce"),$(document).on("click",".show-hide-editor-btn",(function(t){t.preventDefault();var a=$(t.currentTarget).data("result"),i=$("#"+a);i.hasClass("editor-ckeditor")?e.CKEDITOR[a]&&void 0!==e.CKEDITOR[a]?(e.CKEDITOR[a].destroy(),e.CKEDITOR[a]=null,$(".editor-action-item").not(".action-show-hide-editor").hide()):(n.initCkEditor(a,{},"ckeditor"),$(".editor-action-item").not(".action-show-hide-editor").show()):i.hasClass("editor-tinymce")&&tinymce.execCommand("mceToggleEditor",!1,a)})),this.manageShortCode(),this}},{key:"shortcodeCallback",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.href,a=e.key,n=e.description,i=void 0===n?null:n,o=e.data,r=void 0===o?{}:o,l=e.update,d=void 0!==l&&l,c=e.previewImage,s=void 0===c?null:c;$(".short-code-admin-config").html("");var u=$(".short_code_modal .add_short_code_btn");d?u.text(u.data("update-text")):u.text(u.data("add-text")),null!=i&&$(".short_code_modal .modal-title strong").text(i),null!=s&&""!==s?$(".short_code_modal .shortcode-preview-image-link").attr("href",s).show():$(".short_code_modal .shortcode-preview-image-link").hide(),$(".short_code_modal").modal("show"),$(".half-circle-spinner").show(),$.ajax({type:"POST",data:r,url:t,success:function(e){if(e.error)return Botble.showError(e.message),!1;$(".short-code-data-form").trigger("reset"),$(".short_code_input_key").val(a),$(".half-circle-spinner").hide(),$(".short-code-admin-config").html(e.data),Botble.initResources(),Botble.initMediaIntegrate()},error:function(e){Botble.handleError(e)}})}},{key:"manageShortCode",value:function(){var e=this;$(".list-shortcode-items li a").on("click",(function(t){if(t.preventDefault(),"1"==$(this).data("has-admin-config"))e.shortcodeCallback({href:$(this).prop("href"),key:$(this).data("key"),description:$(this).data("description"),previewImage:$(this).data("preview-image")});else{var a=$(".add_shortcode_btn_trigger").data("result"),n="["+$(this).data("key")+"][/"+$(this).data("key")+"]";$(".editor-ckeditor").length>0?e.CKEDITOR[a].commands.execute("shortcode",n):$(".editor-tinymce").length>0&&tinymce.get(a).execCommand("mceInsertContent",!1,n)}})),$.fn.serializeObject=function(){var e={},t=this.serializeArray();return $.each(t,(function(){e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""})),e},$(".add_short_code_btn").on("click",(function(t){t.preventDefault();var a=$(".short_code_modal").find(".short-code-data-form"),n=a.serializeObject(),i="";$.each(n,(function(e,t){var n=a.find('*[name="'+e+'"]'),o=n.data("shortcode-attribute");o&&"content"===o||!t||(e=e.replace("[]",""),"content"!==n.data("shortcode-attribute")&&(e=e.replace("[]",""),i+=" "+e+'="'+t+'"'))}));var o="",r=a.find("*[data-shortcode-attribute=content]");null!=r&&null!=r.val()&&""!==r.val()&&(o=r.val());var l=$(this).closest(".short_code_modal").find(".short_code_input_key").val(),d=$(".add_shortcode_btn_trigger").data("result"),c="["+l+i+"]"+o+"[/"+l+"]";if($(".editor-ckeditor").length>0)e.CKEDITOR[d].commands.execute("shortcode",c);else if($(".editor-tinymce").length>0)tinymce.get(d).execCommand("mceInsertContent",!1,c);else{var s=new CustomEvent("core-insert-shortcode",{detail:{shortcode:c}});document.dispatchEvent(s)}$(this).closest(".modal").modal("hide")}))}}],r&&i(o.prototype,r),l&&i(o,l),e}();$(document).ready((function(){window.EDITOR=(new o).init(),window.EditorManagement=window.EditorManagement||o}))})();